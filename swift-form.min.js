(function($){$.fn.swiftForm=function(options,validationRules,onBeforeSend,onSuccess,onError,onComplete){var settings=$.extend({format:"auto",ajax:!0,action:"",method:"POST",},options);var form=$(this).closest('form');var action=form.attr('action');var method=form.attr('method');var buttonText="";function ResetForm(HtmlForm){HtmlForm.trigger('reset');$('select.resetIt',HtmlForm).each(function(){var defaultValue=$(this).attr('data-default-value');var defaultText=$(this).attr('data-default-text');$(this).empty().append('<option value="'+defaultValue+'">'+defaultText+'</option>')});$('select.emptyIt',HtmlForm).empty();$(HtmlForm).find('input:visible:first').focus()}
function IsMobileNumberValid(mobileNumber){mobileNumber=mobileNumber.trim();if(mobileNumber==''){return!1}
if(isNaN(mobileNumber)){return!1}
if(mobileNumber.length<10){return!1}
var operatorCodes=["013","014","015","016","017","018","019"];if(mobileNumber.startsWith("1")){if(mobileNumber.length!=10){return!1}
var firstTwoDigits=mobileNumber.substr(0,2);var operatorCode="0"+firstTwoDigits;if(!operatorCodes.includes(operatorCode)){return!1}
return!0}
if(mobileNumber.startsWith("01")){if(mobileNumber.length!=11){return!1}
var operatorCode=mobileNumber.substr(0,3);if(!operatorCodes.includes(operatorCode)){return!1}
return!0}
if(mobileNumber.startsWith("8801")){if(mobileNumber.length!=13){return!1}
var operatorCode=mobileNumber.substr(2,3);if(!operatorCodes.includes(operatorCode)){return!1}
return!0}
return!1}
var $currentMessage;function ValidatePhoto(fileInputControl,maximumKB,requiredHeight,requiredWidth){var fileName=fileInputControl.val();var title=fileInputControl.attr("data-title");if(fileName==''){$currentMessage="<strong>"+title+"</strong>"+" required.";showError($currentMessage,fileInputControl);return!1}
var fileInput=fileInputControl[0];var selectedFile=fileInput.files[0];var regex=/^([a-zA-Z0-9\s_\\.\-:])+(.jpeg|.jpg)$/;var arrFileName=fileName.split("\\");if(!regex.test(fileName.toLowerCase())){$currentMessage="<strong>"+title+"</strong>"+" invalid. Please select a .jpg file.";showError($currentMessage,fileInputControl);return!1}
var fileSizeInByte=selectedFile.size;var Units=new Array('Bytes','KB','MB','GB');var unitPosition=0;while(fileSizeInByte>900){fileSizeInByte/=1024;unitPosition++}
var finalSize=(Math.round(fileSizeInByte*100)/100);var finalUnitName=Units[unitPosition];var fileSizeAndUnit=finalSize+' '+finalUnitName;if(finalUnitName!='KB'){$currentMessage="<strong>"+title+"</strong>"+" size is too large. Maximum size is 100 kilobytes.";showError($currentMessage,fileInputControl);return!1}else{if(finalSize>maximumKB){$currentMessage="<strong>"+title+"</strong>"+" size is too large. Maximum size is 100 kilobytes.";showError($currentMessage,fileInputControl);return!1}}
if(typeof(FileReader)!="undefined"){var reader=new FileReader();reader.readAsDataURL(fileInput.files[0]);reader.onload=function(e){var image=new Image();image.src=e.target.result;image.onload=function(){if(this.width!=requiredWidth){$currentMessage="<strong>"+title+"</strong>"+" width invalid. Width must be "+requiredWidth+" pixel.";showError($currentMessage,fileInputControl);return!1}
if(this.height!=requiredHeight){$currentMessage="<strong>"+title+"</strong>"+" height invalid. Height must be "+requiredHeight+" pixel.";showError($currentMessage,fileInputControl);return!1}}}}
return!0}
var submitButton=$(this);var buttonType=submitButton.attr('type');function showError($message,$element){$.sweetModal({content:$message,icon:$.sweetModal.ICON_WARNING});$element.addClass("error");$('html,body').animate({scrollTop:$element.offset().top-50},1000);$element.focus()}
submitButton.on('click',function(event){event.preventDefault();var hasError=!1;form.find('.validate').each(function(i,obj){var $this=$(this);var $currentElement=$this;var title=$this.attr("data-title");if(typeof title==typeof undefined){title=$this.parent('.field').find("label").html()}
var dataType=$this.attr("data-datatype");var value=$this.val();if($this.parent('.field').hasClass("hidden")){return}
var closestToggleVisibleWrapper=$this.closest(".toggleVisibleWrapper");if(typeof closestToggleVisibleWrapper!=typeof undefined){if(closestToggleVisibleWrapper.hasClass("hidden")){return}else{}}
function isDoubleByte(str){for(var i=0,n=str.length;i<n;i++){if(str.charCodeAt(i)>255){return!0}}
return!1}
if($.trim(String(value))!=''){let isInvalid=isDoubleByte($.trim(String(value)));if(isInvalid){hasError=!0;console.log($this.attr('name'));$currentMessage="<strong>"+title+"</strong>"+" must be in english";showError($currentMessage,$currentElement);return!1}}
var isRequired=$this.attr('data-required');if(isRequired!==!1&&typeof isRequired!==typeof undefined){if($this.is(':checkbox')){var checked=$this.is(':checked');if(!checked){hasError=!0;$currentMessage="<strong>"+title+"</strong>"+" required.";console.log($this.attr('name'));showError($currentMessage,$currentElement);return!1}}
if(isRequired=="required"&&value==""){hasError=!0;console.log($this.attr('name'));$currentMessage="<strong>"+title+"</strong>"+" required.";showError($currentMessage,$currentElement);return!1}}
var dataType=$this.attr("data-datatype");if(dataType!==!1&&typeof dataType!==typeof undefined){var length=$.trim(value).length;if(isRequired=="required"||(isRequired=="optional"&&length>0)){switch(dataType){case "letters":var re=/^[a-z\s]+$/i;if(!re.test(value)){hasError=!0;message=title+" invalid.";showError(message,$element);return!1}
break;case "email":var re=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(!re.test(value)){hasError=!0;$currentMessage=title+" invalid.";showError($currentMessage,$currentElement);return!1}
break;case "mobile":if(!IsMobileNumberValid(value)){hasError=!0;$currentMessage="<strong>"+title+"</strong>"+" invalid.";showError($currentMessage,$currentElement);return!1}
break;case "integer":case "float":case "double":case "decimal":if(isNaN(value)){hasError=!0;$currentMessage="<strong>"+title+"</strong>"+" must be a valid number.";showError($currentMessage,$currentElement);return!1}
break;case "date":var dateValue=moment(value,"DD-MM-YYYY");if(!dateValue.isValid()){hasError=!0;$currentMessage="<strong>"+title+"</strong>"+" invalid.";showError($currentMessage,$currentElement);return!1}
break;default:break}}}
var minLength=$this.attr("data-minlen");if(minLength!==!1&&typeof minLength!==typeof undefined){var length=$.trim(value).length;minLength=parseInt(minLength);if(isRequired=="required"||(isRequired=="optional"&&length>0)){if(length<minLength){hasError=!0;console.log($this.attr('name'));$currentMessage="<strong>"+title+"</strong>"+" must be equal or greater than "+minLength+" characters.";showError($currentMessage,$currentElement);return!1}}}
var maxLength=$this.attr("data-maxlen");if(maxLength!==!1&&typeof maxLength!==typeof undefined){var length=$.trim(value).length;maxLength=parseInt(maxLength);if(isRequired=="required"||(isRequired=="optional"&&length>0)){if(length>maxLength){hasError=!0;console.log($this.attr('name'));$currentMessage="<strong>"+title+"</strong>"+" must be equal or less than "+maxLength+" characters.";showError($currentMessage,$currentElement);return!1}}}
var exactLength=$this.attr("data-exactlen");if(exactLength!==!1&&typeof exactLength!==typeof undefined){var length=$.trim(value).length;exactLength=parseInt(exactLength);if(isRequired=="required"||(isRequired=="optional"&&length>0)){if(length!==exactLength){hasError=!0;console.log($this.attr('name'));$currentMessage="<strong>"+title+"</strong>"+" must have "+exactLength+" characters.";showError($currentMessage,$currentElement);return!1}}}
var minValue=$this.attr("data-minval");if(minValue!==!1&&typeof minValue!==typeof undefined){if(dataType!==!1&&typeof dataType===typeof undefined){hasError=!0;$currentMessage="Datatype undefined for "+"<strong>"+title+"</strong>"+".";showError($currentMessage,$currentElement);return!1}
var length=$.trim(value).length;if(isRequired=="required"||(isRequired=="optional"&&length>0)){if(dataType=="integer"||dataType=="float"||dataType=="double"||dataType=="decimal"){if(isNaN(value)){hasError=!0;$currentMessage="<strong>"+title+"</strong>"+" must be a valid number.";showError($currentMessage,$currentElement);return!1}}
switch(dataType){case "integer":value=parseInt(value);minValue=parseInt(minValue);break;case "float":case "double":case "decimal":value=parseFloat(value);minValue=parseFloat(minValue);break;case "date":var value=moment(value,"DD-MM-YYYY");if(!value.isValid()){hasError=!0;$currentMessage="<strong>"+title+"</strong>"+" invalid.";showError($currentMessage,$currentElement);return!1}
minValue=moment(minValue,"DD-MM-YYYY");break;default:hasError=!0;$currentMessage="Datatype undefined for "+"<strong>"+title+"</strong>"+".";showError($currentMessage,$currentElement);return!1}
if(value<minValue){hasError=!0;$currentMessage="<strong>"+title+"</strong>"+" must be equal or greater than "+minValue+".";showError($currentMessage,$currentElement);return!1}}}
var maxValue=$this.attr("data-maxval");if(maxValue!==!1&&typeof maxValue!==typeof undefined){if(dataType!==!1&&typeof dataType===typeof undefined){hasError=!0;$currentMessage="Datatype undefined for "+title+".";showError($currentMessage,$currentElement);return!1}
var length=$.trim(value).length;if(isRequired=="required"||(isRequired=="optional"&&length>0)){if(dataType=="integer"||dataType=="float"||dataType=="double"||dataType=="decimal"){if(isNaN(value)){hasError=!0;$currentMessage="<strong>"+title+"</strong>"+" must be a valid number.";showError($currentMessage,$currentElement);return!1}}
switch(dataType){case "integer":value=parseInt(value);maxValue=parseInt(maxValue);break;case "float":case "double":case "decimal":value=parseFloat(value);maxValue=parseFloat(maxValue);break;case "date":var value=moment(value,"DD-MM-YYYY");if(!value.isValid()){hasError=!0;$currentMessage=title+" invalid.";showError($currentMessage,$currentElement);return!1}
maxValue=moment(maxValue,"DD-MM-YYYY");break;default:hasError=!0;$currentMessage="Datatype undefined for "+"<strong>"+title+"</strong>"+".";showError($currentMessage,$currentElement);return!1}
if(value>maxValue){hasError=!0;$currentMessage="<strong>"+title+"</strong>"+" must be equal or less than "+maxValue+".";showError($currentMessage,$currentElement);return!1}}}
var exactValue=$this.attr("data-exactval");if(exactValue!==!1&&typeof exactValue!==typeof undefined){if(dataType!==!1&&typeof dataType===typeof undefined){hasError=!0;$currentMessage="Datatype undefined for "+title+".";showError($currentMessage,$currentElement);return!1}
var length=$.trim(value).length;if(isRequired=="required"||(isRequired=="optional"&&length>0)){if(dataType=="integer"||dataType=="float"||dataType=="double"||dataType=="decimal"){if(isNaN(value)){hasError=!0;$currentMessage="<strong>"+title+"</strong>"+" must be a valid number.";showError($currentMessage,$currentElement);return!1}}
switch(dataType){case "integer":value=parseInt(value);exactValue=parseInt(exactValue);break;case "float":case "double":case "decimal":value=parseFloat(value);exactValue=parseFloat(exactValue);break;case "date":var value=moment(value,"DD-MM-YYYY");if(!value.isValid()){hasError=!0;$currentMessage="<strong>"+title+"</strong>"+" invalid.";showError($currentMessage,$currentElement);return!1}
exactValue=moment(exactValue,"DD-MM-YYYY");break;default:hasError=!0;$currentMessage="Datatype undefined for "+"<strong>"+title+"</strong>"+".";showError($currentMessage,$currentElement);return!1}
if(value!=exactValue){hasError=!0;$currentMessage="<strong>"+title+"</strong>"+" must be equal to "+exactValue+".";showError($currentMessage,$currentElement);return!1}}}
if($this.hasClass("photo")){var maxSizeInKb=$this.attr("data-maxkb");var requiredHeight=$this.attr("data-height");var requiredWidth=$this.attr("data-width");if(!ValidatePhoto($this,parseInt(maxSizeInKb),parseInt(requiredHeight),parseInt(requiredWidth))){hasError=!0;return!1}}
if($this.hasClass("signature")){var maxSizeInKb=$this.attr("data-maxkb");var requiredHeight=$this.attr("data-height");var requiredWidth=$this.attr("data-width");if(!ValidatePhoto($this,parseInt(maxSizeInKb),parseInt(requiredHeight),parseInt(requiredWidth))){hasError=!0;return!1}}
$currentElement.removeClass("error")});if(hasError){hasError=!1;return}
if(validationRules){if(validationRules()==!1){return}}
if(settings.ajax){SubmitFormAsAuto($(form).serialize())}else{$(form).submit()}});function beforeSendFunction(){if(onBeforeSend){onBeforeSend()}else{if(buttonType=='button'){buttonText=submitButton.html();submitButton.html('Working…');submitButton.attr('disabled','disabled')}else{buttonText=submitButton.val();submitButton.val('Working…');submitButton.attr('disabled','disabled')}}}
function successFunction(response){console.log(response);if(onSuccess){submitButton.removeAttr('disabled');submitButton.val(buttonText);onSuccess(response)}else{if(typeof response.issuccess==typeof undefined){submitButton.removeAttr('disabled');submitButton.val(buttonText);alert("Problem in getting response from server. Please try again.");return!1}
if(response.issuccess){if(typeof response.message!=typeof undefined){$.sweetModal({content:response.message,icon:$.sweetModal.ICON_SUCCESS});if(buttonType=='button'){submitButton.html(buttonText)}else{submitButton.val(buttonText)}}
if(typeof response.redirecturl!=typeof undefined){window.location=response.redirecturl}}else{$.sweetModal({content:response.message,icon:$.sweetModal.ICON_WARNING});submitButton.removeAttr('disabled');if(buttonType=='button'){submitButton.html("Try again")}else{submitButton.val("Try again")}}}}
function errorFunction(xhr,status,error){$('#submit-spinner').hide();if(onError){onError(xhr,status,error)}else{HandleError(xhr,status,error)}}
function completeFunction(){if(onComplete){onComplete()}else{submitButton.removeAttr('disabled')}}
function SubmitFormAsAuto(data){$.ajax({data:data,cache:!1,contentType:!1,processData:!1,type:method,url:action,beforeSend:beforeSendFunction,success:successFunction,error:errorFunction,complete:completeFunction})}
function SubmitFormAsJson(){var $JsonData=ConvertHtmlFormToJson(form);$.ajax({data:JSON.stringify($JsonData),type:method,url:action,contentType:'application/json; charset=utf-8',dataType:'json',beforeSend:beforeSendFunction,success:successFunction,error:errorFunction,complete:completeFunction})}
function ConvertHtmlFormToJson(selector){var ary=$(selector).serializeArray();var obj={};for(var a=0;a<ary.length;a++)obj[ary[a].name]=ary[a].value;return obj}
function HandleError(jqXHR,textStatus,errorThrown){var message="Failed to execute.\n";switch(textStatus){case "timeout":message+="Operation timeout. Pleasy try again.";message+="\n "+jqXHR.statusText+' ('+jqXHR.status+')';break;case "error":message+="An error ouccured.";message+="\n "+jqXHR.statusText+' ('+jqXHR.status+')';break;case "abort":message+="Request aborted.";message+="\n "+jqXHR.statusText+' ('+jqXHR.status+')';break;case "parsererror":message+="Parser error.";message+="\n "+jqXHR.statusText+' ('+jqXHR.status+')';break;default:message+="An unexpected error occured.";message+="\n "+jqXHR.statusText+' ('+jqXHR.status+')';break}
$.sweetModal({content:message,icon:$.sweetModal.ICON_WARNING});console.log(jqXHR.status);console.log(jqXHR.statusText);console.log(textStatus);console.log(errorThrown)}}}(jQuery))